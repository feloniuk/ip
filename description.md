```
app/
‚îú‚îÄ‚îÄ DTOs/                    # Data Transfer Objects
‚îÇ   ‚îî‚îÄ‚îÄ GeoLocationData.php  # –Ü–º–º—É—Ç–∞–±–µ–ª—å–Ω—ñ –æ–±'—î–∫—Ç–∏ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á—ñ –¥–∞–Ω–∏—Ö
‚îú‚îÄ‚îÄ Exceptions/              # –ö–∞—Å—Ç–æ–º–Ω—ñ –≤–∏–∫–ª—é—á–µ–Ω–Ω—è
‚îÇ   ‚îî‚îÄ‚îÄ GeoLocationException.php
‚îú‚îÄ‚îÄ Http/
‚îÇ   ‚îú‚îÄ‚îÄ Controllers/Api/     # API –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ IpAddressController.php
‚îÇ   ‚îú‚îÄ‚îÄ Requests/            # –í–∞–ª—ñ–¥–∞—Ü—ñ—è –∑–∞–ø–∏—Ç—ñ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StoreIpAddressRequest.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ UpdateIpAddressRequest.php
‚îÇ   ‚îî‚îÄ‚îÄ Resources/           # –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è API –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π
‚îÇ       ‚îî‚îÄ‚îÄ IpAddressResource.php
‚îú‚îÄ‚îÄ Models/                  # Eloquent –º–æ–¥–µ–ª—ñ
‚îÇ   ‚îú‚îÄ‚îÄ IpAddress.php
‚îÇ   ‚îî‚îÄ‚îÄ User.php
‚îî‚îÄ‚îÄ Services/                # –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞
    ‚îî‚îÄ‚îÄ GeoLocationService.php
```

## üîÑ –Ø–∫ –ø—Ä–∞—Ü—é—î Request Flow

### 1. **–¢–æ—á–∫–∞ –≤—Ö–æ–¥—É**: Route ‚Üí Controller
```
HTTP Request ‚Üí routes/api.php ‚Üí IpAddressController
```

### 2. **Middleware Chain**:
```
Request ‚Üí Sanctum Auth ‚Üí Permission Check ‚Üí Controller Method
```

### 3. **Controller –æ–±—Ä–æ–±–∫–∞**:
```
Controller ‚Üí Request Validation ‚Üí Service ‚Üí Model ‚Üí Database
```

### 4. **Response Chain**:
```
Database ‚Üí Model ‚Üí Resource ‚Üí JSON Response
```

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏

### **Request Classes** (–í–∞–ª—ñ–¥–∞—Ü—ñ—è)
```php
StoreIpAddressRequest::class
‚îú‚îÄ‚îÄ authorize() - –ü–µ—Ä–µ–≤—ñ—Ä—è—î –¥–æ–∑–≤–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
‚îú‚îÄ‚îÄ rules() - –ü—Ä–∞–≤–∏–ª–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö
‚îî‚îÄ‚îÄ prepareForValidation() - –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–∏—Ö
```

**–ó–∞–≤–¥–∞–Ω–Ω—è**: –í–∞–ª—ñ–¥—É–≤–∞—Ç–∏ –≤—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É

### **Controller** (–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä)
```php
IpAddressController::class
‚îú‚îÄ‚îÄ index() - –°–ø–∏—Å–æ–∫ IP –∑ —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏ —Ç–∞ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—î—é
‚îú‚îÄ‚îÄ store() - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ IP + –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—è
‚îú‚îÄ‚îÄ show() - –û—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ IP
‚îú‚îÄ‚îÄ update() - –û–Ω–æ–≤–ª–µ–Ω–Ω—è –≥–µ–æ–¥–∞–Ω–∏—Ö
‚îî‚îÄ‚îÄ destroy() - –í–∏–¥–∞–ª–µ–Ω–Ω—è IP
```

**–ó–∞–≤–¥–∞–Ω–Ω—è**: –ö–æ–æ—Ä–¥–∏–Ω—É–≤–∞—Ç–∏ –≤–∑–∞—î–º–æ–¥—ñ—é –º—ñ–∂ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏, –æ–±—Ä–æ–±–ª—è—Ç–∏ HTTP –∑–∞–ø–∏—Ç–∏

### **Service Layer** (–ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞)
```php
GeoLocationService::class
‚îú‚îÄ‚îÄ getGeoLocation() - –û—Å–Ω–æ–≤–Ω–∏–π –º–µ—Ç–æ–¥ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≥–µ–æ–¥–∞–Ω–∏—Ö
‚îú‚îÄ‚îÄ validateIpAddress() - –í–∞–ª—ñ–¥–∞—Ü—ñ—è IP –∞–¥—Ä–µ—Å
‚îú‚îÄ‚îÄ checkRateLimit() - –ö–æ–Ω—Ç—Ä–æ–ª—å –ª—ñ–º—ñ—Ç—ñ–≤ API
‚îú‚îÄ‚îÄ fetchFromApi() - –ó–∞–ø–∏—Ç –¥–æ –∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ API
‚îî‚îÄ‚îÄ Cache —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è
```

**–ó–∞–≤–¥–∞–Ω–Ω—è**: –Ü–Ω–∫–∞–ø—Å—É–ª—é–≤–∞—Ç–∏ —Å–∫–ª–∞–¥–Ω—É –ª–æ–≥—ñ–∫—É —Ä–æ–±–æ—Ç–∏ –∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ–º API

### **DTO** (Data Transfer Objects)
```php
GeoLocationData::class (readonly)
‚îú‚îÄ‚îÄ –Ü–º–º—É—Ç–∞–±–µ–ª—å–Ω–∏–π –æ–±'—î–∫—Ç
‚îú‚îÄ‚îÄ –¢–∏–ø–æ–±–µ–∑–ø–µ—á–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–∏—Ö
‚îú‚îÄ‚îÄ toArray() - –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –¥–ª—è –ë–î
‚îî‚îÄ‚îÄ fromApiResponse() - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑ API –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
```

**–ó–∞–≤–¥–∞–Ω–Ω—è**: –ó–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ —Ç–∏–ø–æ–±–µ–∑–ø–µ–∫—É —Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö

### **Model** (Data Layer)
```php
IpAddress::class extends Model
‚îú‚îÄ‚îÄ Eloquent ORM –º–∞–ø–ø—ñ–Ω–≥
‚îú‚îÄ‚îÄ Relationships (belongsTo User)
‚îú‚îÄ‚îÄ Scopes (byCountry, byCity)
‚îú‚îÄ‚îÄ Accessors (getLocationAttribute)
‚îî‚îÄ‚îÄ Casts (—Ç–∏–ø—ñ–∑–∞—Ü—ñ—è –∞—Ç—Ä–∏–±—É—Ç—ñ–≤)
```

**–ó–∞–≤–¥–∞–Ω–Ω—è**: –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç–∏ –¥–∞–Ω—ñ –≤ –±–∞–∑—ñ —Ç–∞ –Ω–∞–¥–∞–≤–∞—Ç–∏ –∑—Ä—É—á–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### **Resource** (Response Formatting)
```php
IpAddressResource::class
‚îú‚îÄ‚îÄ toArray() - –°—Ç—Ä—É–∫—Ç—É—Ä—É–≤–∞–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
‚îú‚îÄ‚îÄ Conditional fields (whenLoaded, when)
‚îú‚îÄ‚îÄ –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö (location, coordinates)
‚îî‚îÄ‚îÄ Role-based visibility
```

**–ó–∞–≤–¥–∞–Ω–Ω—è**: –§–æ—Ä–º–∞—Ç—É–≤–∞—Ç–∏ –≤–∏—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ –¥–ª—è API

## –°–∏—Å—Ç–µ–º–∞ –±–µ–∑–ø–µ–∫–∏

### **Authentication Flow**:
```
1. User login ‚Üí AuthController::login()
2. Sanctum —Å—Ç–≤–æ—Ä—é—î —Ç–æ–∫–µ–Ω
3. –¢–æ–∫–µ–Ω –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ –ë–î (personal_access_tokens)
4. Client –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î —Ç–æ–∫–µ–Ω –≤ Header: "Authorization: Bearer TOKEN"
5. Sanctum middleware –≤–∞–ª—ñ–¥—É—î —Ç–æ–∫–µ–Ω
```

### **Authorization Flow**:
```
1. Spatie Permission –ø–µ—Ä–µ–≤—ñ—Ä—è—î —Ä–æ–ª—ñ
2. User::can('permission') ‚Üí bool
3. –ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä –∞–±–æ Request –±–ª–æ–∫—É—î –¥–æ—Å—Ç—É–ø —è–∫—â–æ false
```

## –ü—Ä–∏–Ω—Ü–∏–ø–∏ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏

### **1. Single Responsibility Principle**
- –ö–æ–∂–µ–Ω –∫–ª–∞—Å –º–∞—î –æ–¥–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—å
- Service —Ç—ñ–ª—å–∫–∏ –¥–ª—è –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—ó
- Controller —Ç—ñ–ª—å–∫–∏ –¥–ª—è HTTP –æ–±—Ä–æ–±–∫–∏
- Resource —Ç—ñ–ª—å–∫–∏ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è

### **2. Dependency Injection**
```php
public function __construct(
    private readonly GeoLocationService $geoLocationService
) {}
```

### **3. Repository Pattern** (—á–∞—Å—Ç–∫–æ–≤–æ)
- Eloquent Model —è–∫ Repository
- Scopes –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤

### **4. DTO Pattern**
- –Ü–º–º—É—Ç–∞–±–µ–ª—å–Ω—ñ –æ–±'—î–∫—Ç–∏ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á—ñ –¥–∞–Ω–∏—Ö
- –¢–∏–ø–æ–±–µ–∑–ø–µ–∫–∞ —Ç–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏

## Data Flow Example

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è IP –∞–¥—Ä–µ—Å–∏:

```
1. POST /api/v1/ip-addresses {"ip_address": "8.8.8.8"}
2. Sanctum middleware –ø–µ—Ä–µ–≤—ñ—Ä—è—î —Ç–æ–∫–µ–Ω
3. StoreIpAddressRequest –≤–∞–ª—ñ–¥—É—î –¥–∞–Ω—ñ —Ç–∞ –ø—Ä–∞–≤–∞
4. IpAddressController::store() –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è
5. GeoLocationService::getGeoLocation("8.8.8.8")
   ‚îú‚îÄ‚îÄ –ü–µ—Ä–µ–≤—ñ—Ä—è—î rate limit
   ‚îú‚îÄ‚îÄ –®—É–∫–∞—î –≤ –∫–µ—à—ñ
   ‚îú‚îÄ‚îÄ –†–æ–±–∏—Ç—å HTTP –∑–∞–ø–∏—Ç –¥–æ ip-api.com
   ‚îî‚îÄ‚îÄ –ü–æ–≤–µ—Ä—Ç–∞—î GeoLocationData DTO
6. IpAddress::create() –∑–±–µ—Ä—ñ–≥–∞—î –≤ –ë–î
7. IpAddressResource —Ñ–æ—Ä–º–∞—Ç—É—î –≤—ñ–¥–ø–æ–≤—ñ–¥—å
8. JSON response –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –∫–ª—ñ—î–Ω—Ç—É
```

## –ü–µ—Ä–µ–≤–∞–≥–∏ —Ç–∞–∫–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏

### **Maintainability** (–ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ—Å—Ç—å)
- –ß—ñ—Ç–∫–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç–µ–π
- –õ–µ–≥–∫–æ –∑–Ω–∞–π—Ç–∏ –¥–µ —â–æ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è
- –ó–º—ñ–Ω–∏ –≤ –æ–¥–Ω–æ–º—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ –Ω–µ –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–∞ —ñ–Ω—à—ñ

### **Testability** (–¢–µ—Å—Ç–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å)
- –ö–æ–∂–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –º–æ–∂–Ω–∞ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –æ–∫—Ä–µ–º–æ
- Dependency Injection –¥–æ–∑–≤–æ–ª—è—î –º–æ–∫–∞—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
- –ß—ñ—Ç–∫–æ –≤–∏–∑–Ω–∞—á–µ–Ω—ñ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏

### **Scalability** (–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å)
- –õ–µ–≥–∫–æ –¥–æ–¥–∞–≤–∞—Ç–∏ –Ω–æ–≤—ñ —Å–µ—Ä–≤—ñ—Å–∏
- –ú–æ–∂–Ω–∞ –≤–∏–Ω–µ—Å—Ç–∏ Service –≤ –æ–∫—Ä–µ–º–∏–π –º—ñ–∫—Ä–æ—Å–µ—Ä–≤—ñ—Å
- –ö–µ—à—É–≤–∞–Ω–Ω—è –∑–º–µ–Ω—à—É—î –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è

### **Security** (–ë–µ–∑–ø–µ–∫–∞)
- –ë–∞–≥–∞—Ç–æ—Ä—ñ–≤–Ω–µ–≤–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è –Ω–∞ –∫–æ–∂–Ω–æ–º—É —Ä—ñ–≤–Ω—ñ
- Rate limiting –∑–∞—Ö–∏—â–∞—î –≤—ñ–¥ –∑–ª–æ–≤–∂–∏–≤–∞–Ω—å

–¶—è –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Å–ª—ñ–¥—É—î **Clean Architecture** –ø—Ä–∏–Ω—Ü–∏–ø–∞–º —Ç–∞ **SOLID** –ø—Ä–∏–Ω—Ü–∏–ø–∞–º, —â–æ —Ä–æ–±–∏—Ç—å –∫–æ–¥ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω–∏–º —Ç–∞ —Ä–æ–∑—à–∏—Ä—é–≤–∞–Ω–∏–º!